# 系统页手动测试指南

## 测试前准备

1. 确保后端服务正在运行
2. 确保前端开发服务器正在运行：`cd frontend && bun run dev`
3. 准备两个测试账号：
   - 管理员账号（is_superuser=true）
   - 普通用户账号（is_superuser=false）

## 测试场景

### 场景 1：管理员访问系统页

**步骤**：
1. 使用管理员账号登录
2. 访问 `/dashboard/system`
3. 验证页面正常加载

**预期结果**：
- ✅ 页面标题显示"系统监控"
- ✅ 显示健康状态徽章（绿色/黄色/红色）
- ✅ 显示筛选器（时间范围、传输方式、流式）
- ✅ 显示 4 张 KPI 卡片
- ✅ 显示 2 张核心趋势图（并排）
- ✅ 显示 Token 使用图表
- ✅ 显示热门模型排行榜
- ✅ 显示 Provider 状态列表

### 场景 2：非管理员访问系统页

**步骤**：
1. 使用普通用户账号登录
2. 访问 `/dashboard/system`

**预期结果**：
- ✅ 显示 403 错误页面
- ✅ 显示盾牌警告图标
- ✅ 显示"访问被拒绝"标题
- ✅ 显示权限要求说明
- ✅ 显示"返回"和"回到首页"按钮

### 场景 3：筛选器功能测试

**步骤**：
1. 以管理员身份访问系统页
2. 切换时间范围（today → 7d → 30d）
3. 切换传输方式（all → http → sdk → claude_cli）
4. 切换流式筛选（all → true → false）

**预期结果**：
- ✅ KPI 卡片数据更新
- ✅ Token 使用图表数据更新
- ✅ 热门模型排行榜数据更新
- ✅ Pulse 图表不受时间范围影响（固定 24h）
- ✅ 所有图表受传输方式和流式筛选影响

### 场景 4：响应式布局测试

**步骤**：
1. 以管理员身份访问系统页
2. 调整浏览器窗口大小：
   - 桌面端（≥1024px）
   - 平板端（768-1023px）
   - 移动端（<768px）

**预期结果**：

**桌面端**：
- ✅ KPI 卡片 4 列布局
- ✅ 核心趋势图 2 列并排
- ✅ 排行榜和 Provider 状态 2 列并排
- ✅ 筛选器在标题右侧

**平板端**：
- ✅ KPI 卡片 2 列布局
- ✅ 核心趋势图 2 列并排
- ✅ 排行榜和 Provider 状态 2 列并排
- ✅ 筛选器可能换行

**移动端**：
- ✅ KPI 卡片 1 列布局
- ✅ 核心趋势图 1 列堆叠
- ✅ 排行榜和 Provider 状态 1 列堆叠
- ✅ 筛选器垂直排列

### 场景 5：暗色模式测试

**步骤**：
1. 以管理员身份访问系统页
2. 切换暗色模式

**预期结果**：
- ✅ 所有卡片背景色正确
- ✅ 文字颜色可读
- ✅ 图表颜色适配暗色主题
- ✅ Provider 状态徽章颜色正确
- ✅ 健康状态徽章颜色正确

### 场景 6：国际化测试

**步骤**：
1. 以管理员身份访问系统页
2. 切换语言（中文 ↔ 英文）

**预期结果**：
- ✅ 页面标题切换语言
- ✅ 筛选器标签切换语言
- ✅ KPI 卡片标题切换语言
- ✅ 图表标题切换语言
- ✅ Provider 状态标签切换语言
- ✅ 错误提示切换语言

### 场景 7：错误处理测试

**步骤**：
1. 以管理员身份访问系统页
2. 模拟 API 错误（关闭后端或修改 API 端点）
3. 刷新页面

**预期结果**：
- ✅ 显示错误提示卡片
- ✅ 显示错误原因
- ✅ 显示"重试"按钮
- ✅ 点击重试按钮重新加载数据

### 场景 8：空数据测试

**步骤**：
1. 以管理员身份访问系统页
2. 选择一个没有数据的时间范围
3. 或者在测试环境中清空数据

**预期结果**：
- ✅ 显示"暂无数据"占位符
- ✅ 不显示空白图表
- ✅ 提供相关操作建议

### 场景 9：加载状态测试

**步骤**：
1. 以管理员身份访问系统页
2. 观察首次加载过程
3. 切换筛选器观察加载过程

**预期结果**：
- ✅ KPI 卡片显示 Skeleton 占位符
- ✅ 图表显示加载动画
- ✅ 表格显示加载状态
- ✅ 没有布局抖动

### 场景 10：性能测试

**步骤**：
1. 以管理员身份访问系统页
2. 打开浏览器开发者工具
3. 观察网络请求和性能指标

**预期结果**：
- ✅ 首屏加载时间 < 2 秒
- ✅ API 请求并行发送
- ✅ SWR 缓存生效（60s 内不重复请求）
- ✅ 切换筛选器时响应迅速

## 常见问题排查

### 问题 1：403 错误页面一直显示

**可能原因**：
- 用户不是管理员
- 用户信息未正确加载
- JWT token 过期

**排查步骤**：
1. 检查用户信息：打开浏览器控制台，查看 `useAuthStore` 的状态
2. 检查 `user.is_superuser` 是否为 `true`
3. 尝试重新登录

### 问题 2：数据不显示

**可能原因**：
- 后端服务未运行
- API 端点错误
- 网络问题

**排查步骤**：
1. 检查浏览器控制台的网络请求
2. 检查后端服务是否正常运行
3. 检查 API 端点是否正确

### 问题 3：图表显示异常

**可能原因**：
- 数据格式不正确
- 图表组件配置错误
- 浏览器兼容性问题

**排查步骤**：
1. 检查浏览器控制台的错误信息
2. 检查 API 返回的数据格式
3. 尝试使用不同的浏览器

### 问题 4：筛选器不生效

**可能原因**：
- 状态管理错误
- API 参数传递错误
- SWR 缓存问题

**排查步骤**：
1. 检查浏览器控制台的网络请求参数
2. 检查 SWR Hook 的参数是否正确
3. 尝试清除浏览器缓存

## 测试报告模板

```markdown
## 测试报告

**测试日期**：YYYY-MM-DD
**测试人员**：[姓名]
**测试环境**：[开发/测试/生产]

### 测试结果

| 场景 | 状态 | 备注 |
|------|------|------|
| 场景 1：管理员访问 | ✅/❌ | |
| 场景 2：非管理员访问 | ✅/❌ | |
| 场景 3：筛选器功能 | ✅/❌ | |
| 场景 4：响应式布局 | ✅/❌ | |
| 场景 5：暗色模式 | ✅/❌ | |
| 场景 6：国际化 | ✅/❌ | |
| 场景 7：错误处理 | ✅/❌ | |
| 场景 8：空数据 | ✅/❌ | |
| 场景 9：加载状态 | ✅/❌ | |
| 场景 10：性能 | ✅/❌ | |

### 发现的问题

1. [问题描述]
   - 严重程度：高/中/低
   - 复现步骤：
   - 预期结果：
   - 实际结果：

### 建议

[测试建议和改进意见]
```

## 自动化测试

虽然本指南主要关注手动测试，但以下测试可以自动化：

1. **单元测试**：测试各个组件的独立功能
2. **集成测试**：测试组件之间的协同工作
3. **E2E 测试**：使用 Playwright 或 Cypress 测试完整流程

建议在手动测试通过后，逐步添加自动化测试覆盖。
